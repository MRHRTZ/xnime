import{r as l,t as h,u as o,v as p,w as b,h as g,j as r,l as c,D as f}from"./index-DsPXEYOx.js";import{H as P}from"./vidstack-html-ECzXWo6K.js";import"./vidstack-92SHiIen-LZy8uKYB.js";class k{constructor(t,e){this.Sa=t,this.b=e,t.textTracks.onaddtrack=this.eb.bind(this),b(this.fb.bind(this))}eb(t){const e=t.track;if(!e||m(this.Sa,e))return;const i=new g({id:e.id,kind:e.kind,label:e.label,language:e.language,type:"vtt"});i[r.gb]={track:e},i[r.hb]=2,i[r.ib]=!0;let s=0;const u=d=>{if(e.cues)for(let a=s;a<e.cues.length;a++)i.addCue(e.cues[a],d),s++};u(t),e.oncuechange=u,this.b.textTracks.add(i,t),i.setMode(e.mode,t)}fb(){var t;this.Sa.textTracks.onaddtrack=null;for(const e of this.b.textTracks){const i=(t=e[r.gb])==null?void 0:t.track;i!=null&&i.oncuechange&&(i.oncuechange=null)}}}function m(n,t){return Array.from(n.children).find(e=>e.track===t)}class S{constructor(t,e){this.jb=(i,s)=>{this.ja.delegate.a("picture-in-picture-change",i,s)},this.Sa=t,this.ja=e,c(this.Sa,"enterpictureinpicture",this.kb.bind(this)),c(this.Sa,"leavepictureinpicture",this.lb.bind(this))}get active(){return document.pictureInPictureElement===this.Sa}get supported(){return o(this.Sa)}async enter(){return this.Sa.requestPictureInPicture()}exit(){return document.exitPictureInPicture()}kb(t){this.jb(!0,t)}lb(t){this.jb(!1,t)}}class T{constructor(t,e){this.mb="inline",this.Sa=t,this.ja=e,c(this.Sa,"webkitpresentationmodechanged",this.qb.bind(this))}get pb(){return h(this.Sa)}async ob(t){this.mb!==t&&this.Sa.webkitSetPresentationMode(t)}qb(t){var i;const e=this.mb;this.mb=this.Sa.webkitPresentationMode,(i=this.ja.player)==null||i.dispatch(new f("video-presentation-change",{detail:this.mb,trigger:t})),["fullscreen","picture-in-picture"].forEach(s=>{(this.mb===s||e===s)&&this.ja.delegate.a(`${s}-change`,this.mb===s,t)})}}class v{constructor(t){this.nb=t}get active(){return this.nb.mb==="fullscreen"}get supported(){return this.nb.pb}async enter(){this.nb.ob("fullscreen")}async exit(){this.nb.ob("inline")}}class x{constructor(t){this.nb=t}get active(){return this.nb.mb==="picture-in-picture"}get supported(){return this.nb.pb}async enter(){this.nb.ob("picture-in-picture")}async exit(){this.nb.ob("inline")}}class j extends P{constructor(t,e){super(t),this.$$PROVIDER_TYPE="VIDEO",l(()=>{if(h(t)){const i=new T(t,e);this.fullscreen=new v(i),this.pictureInPicture=new x(i)}else o(t)&&(this.pictureInPicture=new S(t,e))},this.scope)}get type(){return"video"}setup(t){super.setup(t),p(this.video)&&new k(this.video,t),t.textRenderers.ia(this.video),b(()=>{t.textRenderers.ia(null)}),this.type==="video"&&t.delegate.a("provider-setup",this)}get video(){return this.ja}}export{j as VideoProvider};
