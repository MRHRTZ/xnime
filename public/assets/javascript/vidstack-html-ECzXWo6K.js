import{c as n,w as d,x as o,y as u,i as l,z as c,e as f,l as e,A as j,B as m,a as p,C as g,E as b,D as k,L as a}from"./index-DsPXEYOx.js";import{R as y}from"./vidstack-92SHiIen-LZy8uKYB.js";class T{constructor(t,i){this.Xa=c(),this.tb=!1,this.ub=!1,this.vb=!1,this.K=new y(this.O.bind(this)),this.zb=void 0,this.Qb=void 0,this.xb=t,this.b=i,this.Ab(),f(this.Bb.bind(this)),d(this.fb.bind(this))}get ja(){return this.xb.media}get a(){return this.b.delegate.a}fb(){this.ub=!1,this.vb=!1,this.K.ha(),this.Xa.empty()}O(){const t=this.ja.currentTime;this.b.$state.currentTime()!==t&&this.sb(t)}Ab(){this.rb("loadstart",this.Cb),this.rb("abort",this.yb),this.rb("emptied",this.Db),this.rb("error",this.ba)}Eb(){this.ub||(this.Xa.add(this.rb("loadeddata",this.Fb),this.rb("loadedmetadata",this.Gb),this.rb("canplay",this.Hb),this.rb("canplaythrough",this.Ib),this.rb("durationchange",this.Jb),this.rb("play",this.U),this.rb("progress",this.n),this.rb("stalled",this.Kb),this.rb("suspend",this.Lb)),this.ub=!0)}Mb(){this.vb||(this.Xa.add(this.rb("pause",this.y),this.rb("playing",this.Nb),this.rb("ratechange",this.Ob),this.rb("seeked",this.o),this.rb("seeking",this.Pb),this.rb("ended",this.A),this.rb("volumechange",this._),this.rb("waiting",this.Z)),this.vb=!0)}rb(t,i){return e(this.ja,t,i.bind(this))}Rb(t){}sb(t,i){const s={currentTime:Math.min(t,this.b.$state.seekableEnd()),played:this.ja.played};this.a("time-update",s,i)}Cb(t){if(this.ja.networkState===3){this.yb(t);return}this.Eb(),this.a("load-start",void 0,t)}yb(t){this.a("abort",void 0,t)}Db(){this.a("emptied",void 0,event)}Fb(t){this.a("loaded-data",void 0,t)}Gb(t){this.Mb(),this.a("volume-change",{volume:this.ja.volume,muted:this.ja.muted},t),this.a("loaded-metadata",void 0,t),j&&m(this.b.$state.source())&&this.b.delegate.E(this.wb(),t)}wb(){return{provider:p(this.b.$provider),duration:this.ja.duration,buffered:this.ja.buffered,seekable:this.ja.seekable}}U(t){this.b.$state.canPlay&&this.a("play",void 0,t)}y(t){this.ja.readyState===1&&!this.tb||(this.tb=!1,this.K.ha(),this.a("pause",void 0,t))}Hb(t){this.b.delegate.E(this.wb(),t)}Ib(t){this.b.$state.started()||this.a("can-play-through",this.wb(),t)}Nb(t){this.tb=!1,this.a("playing",void 0,t),this.K.da()}Kb(t){this.a("stalled",void 0,t),this.ja.readyState<3&&(this.tb=!0,this.a("waiting",void 0,t))}Z(t){this.ja.readyState<3&&(this.tb=!0,this.a("waiting",void 0,t))}A(t){this.K.ha(),this.sb(this.ja.duration,t),this.a("end",void 0,t),this.b.$state.loop()&&g(this.ja.controls)&&(this.ja.controls=!1)}Bb(){this.b.$state.paused()&&e(this.ja,"timeupdate",this.z.bind(this))}z(t){this.sb(this.ja.currentTime,t)}Jb(t){this.b.$state.ended()&&this.sb(this.ja.duration,t),this.a("duration-change",this.ja.duration,t)}_(t){const i={volume:this.ja.volume,muted:this.ja.muted};this.a("volume-change",i,t)}o(t){this.sb(this.ja.currentTime,t),this.a("seeked",this.ja.currentTime,t),Math.trunc(this.ja.currentTime)===Math.trunc(this.ja.duration)&&b(this.ja.duration)>b(this.ja.currentTime)&&(this.sb(this.ja.duration,t),this.ja.ended||this.b.player.dispatch(new k("media-play-request",{trigger:t})))}Pb(t){this.a("seeking",this.ja.currentTime,t)}n(t){const i={buffered:this.ja.buffered,seekable:this.ja.seekable};this.a("progress",i,t)}Lb(t){this.a("suspend",void 0,t)}Ob(t){this.a("rate-change",this.ja.playbackRate,t)}ba(t){const i=this.ja.error;if(!i)return;const s={message:i.message,code:i.code,mediaError:i};this.a("error",s,t)}}class v{constructor(t,i){this.xb=t,this.b=i,this.Sb.onaddtrack=this.Ub.bind(this),this.Sb.onremovetrack=this.Vb.bind(this),this.Sb.onchange=this.Wb.bind(this),e(this.b.audioTracks,"change",this.Xb.bind(this))}get Sb(){return this.xb.media.audioTracks}Ub(t){const i=t.track;if(i.label==="")return;const s={id:i.id+"",label:i.label,language:i.language,kind:i.kind,selected:!1};this.b.audioTracks[a.fa](s,t),i.enabled&&(s.selected=!0)}Vb(t){const i=this.b.audioTracks.getById(t.track.id);i&&this.b.audioTracks[a.va](i,t)}Wb(t){let i=this.Tb();if(!i)return;const s=this.b.audioTracks.getById(i.id);s&&this.b.audioTracks[a.$](s,!0,t)}Tb(){return Array.from(this.Sb).find(t=>t.enabled)}Xb(t){const{current:i}=t.detail;if(!i)return;const s=this.Sb.getTrackById(i.id);if(s){const r=this.Tb();r&&(r.enabled=!1),s.enabled=!0}}}class A{constructor(t){this.scope=n(),this.k=null,this.ja=t}setup(t){new T(this,t),"audioTracks"in this.media&&new v(this,t),d(()=>{this.ja.setAttribute("src",""),this.ja.load()})}get type(){return""}get media(){return this.ja}get currentSrc(){return this.k}setPlaybackRate(t){this.ja.playbackRate=t}async play(){return this.ja.play()}async pause(){return this.ja.pause()}setMuted(t){this.ja.muted=t}setVolume(t){this.ja.volume=t}setCurrentTime(t){this.ja.currentTime=t}setPlaysinline(t){o(this.ja,"playsinline",t)}async loadSource({src:t,type:i},s){this.ja.preload=s||"",u(t)?this.ja.srcObject=t:(this.ja.srcObject=null,this.ja.src=l(t)?t:window.URL.createObjectURL(t)),this.ja.load(),this.k={src:t,type:i}}}export{A as H};
